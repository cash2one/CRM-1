function bootstrapAlert(t,a){return'<div class="alert alert-'+(a||"danger")+' alert-dismissable" role="alert">'+t+'</div><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'}function emailCheck(t){var a=/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;return a.test(t)}function getChecked(t){var a=[];return $('input[name="'+t+'"]:checked').each(function(){a.push($(this).val())}),a.join(",")}function getCheckedArray(t){var a=[];return $('input[name="'+t+'"]:checked').each(function(){a.push($(this).val())}),a}function backpage(){location.href=document.referrer}function backtopage(){history.go(-1)}function filterEffect(t){$(t).addClass("selected").siblings().removeClass("selected")}function getFilterValue(){var t={};return $(".filter").find("li").each(function(){t[$(this).children("p").attr("value")]=$(this).children(".selected").val()}),t}function checkSelectVal(t){return t.children("option").length>1?!("0"===t.val()):!0}function checkCustomerForm(){var t=$("#type");if(!checkSelectVal(t))return t.parent().addClass("has-error"),alert("请选择客户类型！"),!1;var a=$("#category1");if(!checkSelectVal(a))return a.parent().addClass("has-error"),alert("请选择客户客户一级类目！"),!1;var e=$("#category2");if(!checkSelectVal(e))return e.parent().addClass("has-error"),alert("请选择客户客户二级类目！"),!1;var o=$("#category3");if(!checkSelectVal(o))return o.parent().addClass("has-error"),alert("请选择客户客户三级类目！"),!1;var n=$("#zone");if(n.is("select")&&"0"===n.val())return n.parent().addClass("has-error"),alert("请选择大区！"),!1;var r=$("#province");return checkSelectVal(r)?!0:(r.parent().addClass("has-error"),alert("请选择省份！"),!1)}function getCustomerData(){return{name:$("#name").val(),short_name:$("#short-name").val(),type:$("#type").val(),priority:$("#priority").val(),category1:$("#category1").val(),category2:$("#category2").val(),category3:$("#category3").val(),zone:$("#zone").val(),registered_capital:$("#registered-capital").val(),shareholder:$("#shareholder").val(),product_desc:$("#product-desc").val(),province:$("#province").val(),city:$("#city").val(),address:$("#address").val(),notes:$("#notes").val(),businessmans_id:getCheckedArray("businessman")}}function checkCustomerData(t){return t.name?t.short_name?$.trim(t.registered_capital)?t.shareholder?t.product_desc?t.city?$.isNumeric(t.registered_capital)?!0:($("#registered-capital").parent().addClass("has-error"),alert("注册资本不是一个有效的数字"),!1):($("#city").parent().addClass("has-error"),alert("城市为必填项"),!1):($("#product-desc").parent().addClass("has-error"),alert("客户业务或产品描述为必填项"),!1):($("#short-name").parent().addClass("has-error"),alert("股东为必填项"),!1):($("#registered-capital").parent().addClass("has-error"),alert("注册资本为必填项"),!1):($("#short-name").parent().addClass("has-error"),alert("简称为必填项"),!1):($("#name").parent().addClass("has-error"),alert("客户名称为必填项"),!1)}function customerAdd(){$("form").find("div.has-error").removeClass("has-error");var t=getCustomerData();if(checkCustomerData(t)&&checkCustomerForm()){var a="/crm/ajax/customer/add/";$.post(a,JSON.stringify(t),function(t){"0"==t.msg?backpage():alert(t.msg)})}}function customerEdit(t){$("form").find("div.has-error").removeClass("has-error");var a=getCustomerData();if(a.id=t,checkCustomerData(a)&&checkCustomerForm()){var e="/crm/ajax/customer/edit/";$.post(e,JSON.stringify(a),function(t){"0"==t.msg?backpage():alert(t.msg)})}}function customerView(t){var a="/crm/ajax/customer/view/",e=$("#table-view").children("tbody");e.empty(),$.getJSON(a,{customer_id:t},function(t){if(0==t.msg){data=t.data;for(var a=0;a<data.length;a++)e.append('<tr class="default"><th scope="row">'+data[a].name+"</th><td>"+data[a].value+"</td></tr>")}else alert(t.msg)})}function confirmDelCustomer(t,a){var e=$("#confirm-modal");e.modal("show"),e.find(".modal-body").html("<p>确认要删除<strong>"+a+"</strong>吗？"),e.find(".modal-footer button").val(t)}function customerDel(){var t=$(this).val(),a="/crm/ajax/customer/del/";$.getJSON(a,{customer_id:t},function(t){if("0"==t.msg){var a=$("#confirm-modal");a.modal("hide"),location.reload()}else alert(t.msg)})}function remove_table_line(t,a){$("#"+t+" tr:eq("+a+")").remove()}function append_table_line(t,a){$("#"+t).append(a)}function table_del(t){var a=$(t).val();$("#table-contact tr:eq("+a+")").remove(),table_line_each()}function table_line_each(){$("#table-contact tr:gt(0)").each(function(t){$(this).children("th").html(t+1),$(this).find("button").attr("value",t+1)})}function GetTableData(t){var a=[];return $(t+" tr:gt(0)").each(function(t,e){a[t]=[],$(e).find("td").each(function(e,o){a[t][e]=$(o).text()})}),a}function showContactViewModal(t){var a=$("#contact-info-modal");a.modal("show");var e="/crm/ajax/contact/view/";$.getJSON(e,{contact_id:t},function(t){0==t.msg?($("#table_view tr:eq(0) td:eq(0)").html(t.name),$("#table_view tr:eq(1) td:eq(0)").html(t.pos),$("#table_view tr:eq(2) td:eq(0)").html(t.phone),$("#table_view tr:eq(3) td:eq(0)").html(t.mobile),$("#table_view tr:eq(4) td:eq(0)").html(t.mail)):alert(t.msg)})}function show_contact_add_modal(){var t=$("#contact-add-modal");t.modal("show");t.find(".modal-body input[name='contact-name']").val(""),t.find(".modal-body input[name='contact-pos']").val(""),t.find(".modal-body input[name='contact-tel']").val(""),t.find(".modal-body input[name='contact-mobile']").val(""),t.find(".modal-body input[name='contact-mail']").val("")}function ajaxContactCreate(t){var a=$("#contact-add-modal"),e=a.find(".modal-body input[name='contact-name']").val(),o=a.find(".modal-body input[name='contact-pos']").val(),n=a.find(".modal-body input[name='contact-tel']").val(),r=a.find(".modal-body input[name='contact-mobile']").val(),l=a.find(".modal-body input[name='contact-mail']").val();if(!emailCheck(l))return alert("请正确填写email地址！"),!1;if(e&&r){var d={project_id:t,name:e,pos:o,tel:n,mobile:r,mail:l},i="/crm/ajax/contact/add/";$.getJSON(i,d,function(t){0==t.msg?(a.modal("hide"),$("#contact").get(0).options.add(new Option(t.contact_name,t.contact_id)),$("#contact").val(t.contact_id)):alert(t.msg)})}else alert("名字和手机不能为空！")}function contact_add(){var t=$("#contact-add-modal"),a=t.find(".modal-body input[name='contact-name']").val(),e=t.find(".modal-body input[name='contact-pos']").val(),o=t.find(".modal-body input[name='contact-tel']").val(),n=t.find(".modal-body input[name='contact-mobile']").val(),r=t.find(".modal-body input[name='contact-mail']").val();if(!emailCheck(r))return alert("请正确填写email地址！"),!1;if(a&&n){var l=$("#table-contact"),d=l.find("tbody"),i=$("#table-contact tr").length;d.append('<tr><th scope="row">'+i+"</th><td>"+a+"</td><td>"+e+"</td><td>"+o+"</td><td>"+n+"</td><td>"+r+'</td><td><button type="button" class="btn btn-sm btn-success" value='+i+' onclick="table_del(this)">删除</button></td></tr>'),t.modal("hide")}else alert("名字和手机不能为空！")}function ajaxContactAdd(t){var a=$("#contact-add-modal"),e=a.find(".modal-body input[name='contact-name']").val(),o=a.find(".modal-body input[name='contact-pos']").val(),n=a.find(".modal-body input[name='contact-tel']").val(),r=a.find(".modal-body input[name='contact-mobile']").val(),l=a.find(".modal-body input[name='contact-mail']").val();if(!emailCheck(l))return alert("请正确填写email地址！"),!1;if(e&&r){var d={project_id:t,name:e,pos:o,tel:n,mobile:r,mail:l},i="/crm/ajax/contact/add/";$.getJSON(i,d,function(t){"0"==t.msg?(a.modal("hide"),location.reload()):alert(t.msg)})}else alert("名字和手机不能为空！")}function show_contact_edit(t){var a=$(t).val(),e=$("#contact-edit-modal");e.modal("show");var o=a.split(","),n=o[0],r=o[1],l=GetTableData("#table-contact"),d=l[r-1];e.find(".modal-body input[name='contact-name']").val(d[0]),e.find(".modal-body input[name='contact-pos']").val(d[1]),e.find(".modal-body input[name='contact-tel']").val(d[2]),e.find(".modal-body input[name='contact-mobile']").val(d[3]),e.find(".modal-body input[name='contact-mail']").val(d[4]),e.find(".modal-footer button").val(n)}function contact_edit(t){var a=$(t).val(),e=$("#contact-edit-modal"),o=e.find(".modal-body input[name='contact-name']").val(),n=e.find(".modal-body input[name='contact-pos']").val(),r=e.find(".modal-body input[name='contact-tel']").val(),l=e.find(".modal-body input[name='contact-mobile']").val(),d=e.find(".modal-body input[name='contact-mail']").val();if(!emailCheck(d))return alert("请正确填写email地址！"),!1;if(o&&l){var i={contact_id:a,name:o,pos:n,tel:r,mobile:l,mail:d},s="/crm/ajax/contact/edit/";$.getJSON(s,i,function(t){0==t.msg?(e.modal("hide"),location.reload()):alert(t.msg)})}else alert("名字和手机不能为空！")}function show_contact_del(t){var a=$(t).val(),e=$("#confirm-modal");e.modal("show");var o=a.split(","),n=o[0],r=o[1];e.find(".modal-title strong").html("删除联系人"),e.find(".modal-body").html("<h5>确认要删除<strong>"+r+"</strong>吗？</h5>"),e.find(".modal-footer button[class='btn btn-success']").attr("onclick","contact_del(this)"),e.find(".modal-footer button[class='btn btn-success']").attr("value",n)}function contact_del(t){var a=$("#confirm-modal"),e=$(t).val(),o="/crm/ajax/contact/del/";$.getJSON(o,{contact_id:e},function(t){if(0==t.msg)a.modal("hide"),location.reload();else{var e=a.find(".modal-body strong").html();a.find(".modal-body").html("<h5>无法删除<strong>"+e+"</strong></h5><p style='color:red;'>"+t.msg+"</p>")}})}function ajax_project_add(){var t=$("input[name='project-name']").val();if(!t)return void alert("项目名称不能为空！");var a=$("select[name='customer-name']").val(),e=getChecked("product");if(!e)return void alert("至少选择一个产品!");var o=$("select[name='priority']").val(),n=$("textarea[name='notes']").val();if(a)if(t){var r=GetTableData("#table-contact"),l={project_name:t,customer_id:a,products_id:e,priority:o,notes:n,contacts:r};$.ajax({type:"POST",url:"/crm/ajax/project/add/",contentType:"application/json; charset=utf-8",data:JSON.stringify(l),dataType:"json",success:function(t){"0"==t.msg?backpage():alert(t.msg)},error:function(t){alert("添加项目失败！")}})}else alert("请填写项目名称！");else alert("您还没有跟进任何客户,无法添加项目！"),backpage()}function ajax_project_edit(t){var a=$("#project-edit-form"),e=a.find("input[name='project-name']").val();if(!e)return void alert("项目名称不能为空！");var o=a.find("select[name='customer-name']").val(),n=getChecked("product");if(!n)return void alert("至少选择一个产品!");var r=a.find("select[name='priority']").val(),l=getChecked("businessman"),d=a.find("textarea[name='notes']").val(),i={project_id:t,project_name:e,customer_id:o,priority:r,products_id:n,notes:d,businessmans_id:l},s="/crm/ajax/project/edit/";$.getJSON(s,i,function(t){"0"==t.msg?location.href="/crm/projects/0/0/0/0/":alert(t.msg)})}function show_project_del(t,a){var e=$("#confirm-modal");e.modal("show"),e.find(".modal-title strong").html("删除项目"),e.find(".modal-body").html("<h4>确认要删除<strong>"+a+"</strong>吗？</h4>"),e.find(".modal-footer button").val(t)}function project_del(t){var a=$("#confirm-modal"),e=$(t).val(),o="/crm/ajax/project/del/";$.getJSON(o,{project_id:e},function(t){"0"==t.msg?(a.modal("hide"),location.reload()):alert(t.msg)})}function show_update_progress(t){var a=$("#update-progress-modal");a.modal("show");var e=$(t).val(),o=e.split(","),n=o[0],r=o[1],l=o[2];void 0!=l&&(0==l&&(l=1),a.find(".modal-body select[name='progress']").val(l)),a.find(".modal-title strong").html(r+"进度更新"),a.find(".modal-footer button").val(n)}function update_progress(t){var a=$(t).val(),e=$("#update-progress-modal"),o=e.find(".modal-body"),n=o.find("select[name='progress']").val(),r=o.find("textarea[name='description']").val(),l=o.find("textarea[name='plan']").val(),d=o.find("input[name='datetime']").val();if(r){var i={project_id:a,progress:n,description:r,plan:l,updatetime:d},s="/crm/ajax/progress/add/";$.post(s,JSON.stringify(i),function(t){"0"==t.msg?(e.modal("hide"),location.reload()):alert(t.msg)},"json")}else alert("请简单填写项目进展！")}function update_test_progress(t){var a=$(t).val(),e=$("#update-progress-modal"),o=e.find(".modal-body"),n=o.find("select[name='progress']").val(),r=o.find("select[name='test-progress']").val(),l=o.find("textarea[name='description']").val(),d=o.find("textarea[name='plan']").val(),i=o.find("input[name='datetime']").val();if(l){var s={project_id:a,progress:n,test_progress:r,description:l,plan:d,updatetime:i},c="/crm/ajax/progress/add/";$.post(c,JSON.stringify(s),function(t){"0"==t.msg?(e.modal("hide"),location.reload()):alert(t.msg)},"json")}else alert("请简单描述测试进展！")}function update_imp_progress(t){var a=$(t).val(),e=$("#update-progress-modal"),o=e.find(".modal-body"),n=o.find("select[name='progress']").val(),r=o.find("select[name='imp-progress']").val(),l=o.find("textarea[name='description']").val(),d=o.find("textarea[name='plan']").val(),i=o.find("input[name='datetime']").val();if(l){var s={project_id:a,progress:n,imp_progress:r,description:l,plan:d,updatetime:i},c="/crm/ajax/progress/add/";$.post(c,JSON.stringify(s),function(t){"0"==t.msg?(e.modal("hide"),location.reload()):alert(t.msg)},"json")}else alert("请简单描述实施进展！")}function show_progress_add(t){var a=$("#progress-modal");a.modal("show");var e=$(t).val(),o=e.split(","),n=o[0],r=o[1];0==r&&(r=1),a.find(".modal-title strong").html("添加项目进度"),a.find(".modal-body select[name='progress']").val(r),a.find(".modal-body textarea[name='description']").val(""),a.find(".modal-body textarea[name='plan']").val(""),a.find(".modal-body input[name='datetime']").val(""),a.find(".modal-footer button").val(n),a.find(".modal-footer button[class='btn btn-success']").attr("onclick","progress_add(this)")}function progress_add(t){var a=$(t).val(),e=$("#progress-modal"),o=e.find(".modal-body"),n=o.find("select[name='progress']").val(),r=o.find("textarea[name='description']").val(),l=o.find("textarea[name='plan']").val(),d=o.find("input[name='datetime']").val();if(r){var i={project_id:a,progress:n,description:r,plan:l,updatetime:d},s="/crm/ajax/progress/add/";$.post(s,JSON.stringify(i),function(t){"0"==t.msg?(e.modal("hide"),location.reload()):alert(t.msg)},"json")}else alert("请简单填写项目进展！")}function show_progress_edit(t){var a=$("#progress-modal");a.modal("show");var e=$(t).val(),o=e.split(","),n=o[0],r=o[1],l=GetTableData("#table-progress"),d=l[r-1];a.find(".modal-title strong").html("编辑进度");var i={"准备":1,"接洽":2,"测试/试用":3,"谈判":4,"上线":5,"售后":6};a.find(".modal-body select[name='progress']").val(i[d[1]]),a.find(".modal-body textarea[name='description']").val(d[2]),a.find(".modal-body textarea[name='plan']").val(d[3]),a.find(".modal-body input[name='datetime']").val(d[0]),a.find(".modal-footer button").val(n),a.find(".modal-footer button[class='btn btn-success']").attr("onclick","progress_edit(this)")}function progress_edit(t){var a=$(t).val(),e=$("#progress-modal"),o=e.find(".modal-body"),n=o.find("select[name='progress']").val(),r=o.find("textarea[name='description']").val(),l=o.find("textarea[name='plan']").val(),d=o.find("input[name='datetime']").val();if(r){var i={progress_id:a,progress:n,description:r,plan:l,updatetime:d},s="/crm/ajax/progress/edit/";$.post(s,JSON.stringify(i),function(t){"0"==t.msg?(e.modal("hide"),location.reload()):alert(t.msg)},"json")}else alert("请简单填写项目进展！")}function show_progress_del(t){var a=$(t).val(),e=$("#confirm-modal");e.modal("show"),e.find(".modal-title strong").html("删除进度"),e.find(".modal-body").html("<h5>确认要删除这条进度信息吗？</h5>"),e.find(".modal-footer button[class='btn btn-success']").attr("onclick","progress_del(this)"),e.find(".modal-footer button[class='btn btn-success']").attr("value",a)}function progress_del(t){var a=$("#confirm-modal"),e=$(t).val(),o="/crm/ajax/progress/del/";$.getJSON(o,{progress_id:e},function(t){"0"==t.msg?(a.modal("hide"),location.reload()):alert(t.msg)})}function show_mark_modal(t,a){var e=$("#mark-modal");e.modal("show"),e.find(".modal-body textarea[name='content']").val(a),e.find(".modal-footer button[class='btn btn-success']").attr("value",t)}function mark_edit(t){var a=$(t).val(),e=$("#mark-modal"),o=e.find(".modal-body textarea[name='content']").val();if(o){var n={progress_id:a,content:o},r="/crm/ajax/mark/edit/";$.post(r,JSON.stringify(n),function(t){"0"==t.msg?(e.modal("hide"),location.reload()):alert(t.msg)},"json")}else alert("请填写标注内容！")}function testApplyAdd(t){var a=$("#analyser").val(),e=$("#amount-data").val(),o=$("#goal").val(),n=$("#fields").val(),r=$("#notes").val(),l=$("#contact").val(),d=getCheckedArray("test-result"),i=getCheckedArray("overdue-state");if(!e)return alert("请填写测试数据量"),!1;if(isNaN(Number(e)))return alert("测试数据量不是一个有效的数字"),!1;if(Number(e)<=0)return alert("测试数据量不是一个有效的数字"),!1;if(!o)return alert("请填写本次测试目标"),!1;if(!n)return alert("请填写客户提供的测试字段"),!1;if(0==d.length)return alert("请选择测试结果要求"),!1;if(!l)return alert("缺少联系人"),!1;i=!(0==i.length);var s={project_id:t,analyser_id:a,amount_data:e,goal:o,fields:n,notes:r,test_result_id:d,overdue_state:i,contact_id:l},c="/crm/test-apply/add/";$.post(c,JSON.stringify(s),function(t){0==t.msg?backpage():alert(t.msg)},"json")}function testApplyEdit(t){var a=$("#analyser").val(),e=$("#amount-data").val(),o=$("#goal").val(),n=$("#fields").val(),r=$("#notes").val(),l=$("#contact").val(),d=getCheckedArray("test-result"),i=getCheckedArray("overdue-state");if(!e)return alert("请填写测试数据量"),!1;if(isNaN(Number(e)))return alert("测试数据量不是一个有效的数字"),!1;if(Number(e)<=0)return alert("测试数据量不是一个有效的数字"),!1;if(!o)return alert("请填写本次测试目标"),!1;if(!n)return alert("请填写客户提供的测试字段"),!1;if(0==d.length)return alert("请选择测试结果要求"),!1;if(!l)return alert("缺少联系人"),!1;i=!(0==i.length);var s={test_apply_id:t,analyser_id:a,amount_data:e,goal:o,fields:n,notes:r,test_result_id:d,overdue_state:i,contact_id:l},c="/crm/test-apply/edit/";$.post(c,JSON.stringify(s),function(t){0==t.msg?backpage():alert(t.msg)},"json")}function showTestApplyProgressAddModal(t,a,e){var o=$("#update-progress-modal"),n=$("#progress_dom");a?(n.hide(),$("#progress").val(4),o.find(".modal-title strong").html("理由或建议")):(n.show(),$("#progress").val(e),o.find(".modal-title strong").html("更新进度")),o.find(".modal-footer button[class='btn btn-success']").attr("onclick",'testApplyProgressAdd("'+t+'")'),o.modal("show")}function testApplyProgressAdd(t){var a=$("#update-progress-modal"),e=$("#progress").val(),o=$("#description").val();return o?void $.getJSON(t,{progress:e,description:o},function(t){0==t.msg?(a.modal("hide"),location.href="/crm/test-apply/list/"+e+"/0/0/"):alert(t.msg)}):(alert("请简单填写描述信息"),!1)}function showDeleteConfirmModal(t){var a=$("#confirm-modal");a.modal("show"),a.find(".modal-title strong").html("删除测试申请"),a.find(".modal-body").html("<h5>确认要删除这个申请吗？</h5>"),a.find(".modal-footer button[class='btn btn-success']").attr("value",t)}function testApplyDel(t){var a=$("#confirm-modal"),e=$(t).val(),o="/crm/test-apply/del/";$.getJSON(o,{test_apply_id:e},function(t){"0"==t.msg?(a.modal("hide"),location.href="/crm/test-apply/list/4/0/0/"):alert(t.msg)})}function showSelectProductModel(t){var a=$("#select-product-modal");a.find(".modal-footer button[class='btn btn-success']").attr("value",t);var e=a.find(".modal-body select[name='product']").get(0);e.options.length=0;var o="/crm/ajax/get-project-products/";$.getJSON(o,{projectid:t},function(t){if(0==t.msg){var o=t.products;for(var n in o)e.options.add(new Option(o[n].name,o[n].id));a.modal("show")}else alert(t.msg)})}function locateImpApply(t){var a=$(t).val(),e=$("#select-product-modal");e.modal("hide");var o=e.find(".modal-body select[name='product']").val();location.href="/crm/imp-apply/add/"+a+"/"+o+"/"}function showImpApplyProgressAddModal(t,a){var e=$("#update-progress-modal");e.find(".modal-footer button[class='btn btn-success']").attr("onclick",'impApplyProgressAdd("'+t+'",'+a+")"),e.modal("show")}function impApplyProgressAdd(t,a){var e=$("#update-progress-modal"),o=$("#description").val();$.getJSON(t,{progress:a,description:o},function(t){if(0==t.msg){e.modal("hide");var o=1;40==a?o=2:45==a?o=3:50==a?o=4:13==a&&(o=5),location.href="/crm/imp-apply/list/"+o+"/0/0/"}else alert(t.msg)})}function showImpApplyDelModal(t){var a=$("#confirm-modal");a.modal("show"),a.find(".modal-title strong").html("删除交付申请"),a.find(".modal-body").html("<h5>确认要删除这个交付申请吗？</h5>"),a.find(".modal-footer button[class='btn btn-success']").attr("value",t)}function impApplyDel(t){var a=$("#confirm-modal"),e=$(t).val(),o="/crm/imp-apply/del/";$.getJSON(o,{imp_apply_id:e},function(t){0==t.msg?(a.modal("hide"),location.href="/crm/imp-apply/list/5/0/0/"):alert(t.msg)})}